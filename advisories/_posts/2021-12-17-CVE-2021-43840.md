---
layout: advisory
title: 'CVE-2021-43840 (message_bus): Path traversal when MessageBus::Diagnostics
  is enabled'
comments: false
categories:
- message_bus
advisory:
  gem: message_bus
  cve: 2021-43840
  ghsa: xmgj-5fh3-xjmm
  url: https://github.com/discourse/message_bus/security/advisories/GHSA-xmgj-5fh3-xjmm
  title: Path traversal when MessageBus::Diagnostics is enabled
  date: 2021-12-17
  description: |
    ### Impact

    Users who deployed message bus with diagnostics features enabled (default off) were
    vulnerable to a path traversal bug, which could lead to disclosure of secret
    information on a machine if an unintended user were to gain access to the diagnostic
    route. The impact is also greater if there is no proxy for your web application as
    the number of steps up the directories is not bounded. For deployments which uses a
    proxy, the impact varies. For example, If a request goes through a proxy like Nginx
    with `merge_slashes` enabled, the number of steps up the directories that can be
    read is limited to 3 levels.

    ### Workarounds

    Disable MessageBus::Diagnostics in production like environments.
  cvss_v3: 4.2
  patched_versions:
  - ">= 3.3.7"
  related:
    url:
    - https://github.com/discourse/message_bus/commit/9b6deee01ed474c7e9b5ff65a06bb0447b4db2ba
---
