---
layout: advisory
title: 'CVE-2023-38697 (protocol-http1): protocol-http1 HTTP Request/Response Smuggling
  vulnerability'
comments: false
categories:
- protocol-http1
advisory:
  gem: protocol-http1
  cve: 2023-38697
  ghsa: 6jwc-qr2q-7xwj
  url: https://github.com/socketry/protocol-http1/security/advisories/GHSA-6jwc-qr2q-7xwj
  title: protocol-http1 HTTP Request/Response Smuggling vulnerability
  date: 2023-08-03
  description: |
    ### Impact

    [RFC 9112 Section 7.1](https://www.rfc-editor.org/rfc/rfc9112#name-chunked-transfer-coding)
    defined the format of chunk size, chunk data and chunk
    extension (detailed ABNF is in Appendix section).

    In summary:

    - The value of Content-Length header should be a string of 0-9 digits.
    - The chunk size should be a string of hex digits and should split
       from chunk data using CRLF.
    - The chunk extension shouldn't contain any invisible character.

    However, we found that Falcon has following behaviors while
    disobey the corresponding RFCs.

    - Falcon accepts Content-Length header values that have "+" prefix.
    - Falcon accepts Content-Length header values that written in
      hexadecimal with "0x" prefix.
    - Falcon accepts "0x" and "+" prefixed chunk size.
    - Falcon accepts LF in chunk extension.

    This behavior can lead to desync when forwarding through multiple
    HTTP parsers, potentially results in HTTP request smuggling and
    firewall bypassing. Note that while these issues were reproduced
    in Falcon (the server), the issue is with `protocol-http1` which
    implements the HTTP/1 protocol parser. We have not yet been advised
    of any real world exploit or practical attack.

    ### Patches

    Fixed in `protocol-http1` v0.15.1+.

    ### Workarounds

    No.

    ### References

    https://github.com/socketry/protocol-http1/pull/20
  cvss_v3: 5.8
  patched_versions:
  - ">= 0.15.1"
  related:
    url:
    - https://github.com/socketry/protocol-http1/security/advisories/GHSA-6jwc-qr2q-7xwj
    - https://github.com/socketry/protocol-http1/pull/20
    - https://github.com/socketry/protocol-http1/commit/e11fc164fd2b36f7b7e785e69fa8859eb06bcedd
    - https://github.com/advisories/GHSA-6jwc-qr2q-7xwj
  notes: CVE-2023-38697 not yet published
---
