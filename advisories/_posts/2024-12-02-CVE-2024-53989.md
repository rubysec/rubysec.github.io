---
layout: advisory
title: 'CVE-2024-53989 (rails-html-sanitizer): rails-html-sanitizer has XSS vulnerability
  with certain configurations'
comments: false
categories:
- rails-html-sanitizer
- rails
advisory:
  gem: rails-html-sanitizer
  framework: rails
  cve: 2024-53989
  ghsa: rxv5-gxqc-xx8g
  url: https://github.com/rails/rails-html-sanitizer/security/advisories/GHSA-rxv5-gxqc-xx8g
  title: rails-html-sanitizer has XSS vulnerability with certain configurations
  date: 2024-12-02
  description: |
    ## Summary

    There is a possible XSS vulnerability with certain configurations of
    Rails::HTML::Sanitizer 1.6.0 when used with Rails >= 7.1.0.

    * Versions affected: 1.6.0
    * Not affected: < 1.6.0
    * Fixed versions: 1.6.1

    ## Impact

    A possible XSS vulnerability with certain configurations of
    Rails::HTML::Sanitizer may allow an attacker to inject content if
    HTML5 sanitization is enabled and the application developer has
    overridden the sanitizer's allowed tags in the following way:

    - the "noscript" element is explicitly allowed

    Code is only impacted if Rails is configured to use HTML5 sanitization,
    please see documentation for [`config.action_view.sanitizer_vendor`](https://guides.rubyonrails.org/configuring.html#config-action-view-sanitizer-vendor)
    and [`config.action_text.sanitizer_vendor`](https://guides.rubyonrails.org/configuring.html#config-action-text-sanitizer-vendor)
    for more information on these configuration options.

    The default configuration is to disallow all of these elements. Code
    is only impacted if allowed tags are being overridden. Applications
    may be doing this in a few different ways:

    1. using application configuration to configure Action View sanitizers'
       allowed tags:

      ```ruby
      # In config/application.rb
      config.action_view.sanitized_allowed_tags = ["noscript"]
      ```

      see https://guides.rubyonrails.org/configuring.html#configuring-action-view

    2. using a `:tags` option to the Action View helper `sanitize`:

      ```
      <= sanitize @comment.body, tags: ["noscript"] >
      ```

      see https://api.rubyonrails.org/classes/ActionView/Helpers/SanitizeHelper.html#method-i-sanitize

    3. setting Rails::HTML5::SafeListSanitizer class attribute `allowed_tags`:

      ```ruby
      # class-level option
      Rails::HTML5::SafeListSanitizer.allowed_tags = ["noscript"]
      ```

      (note that this class may also be referenced as
      `Rails::Html::SafeListSanitizer`)

    4. using a `:tags` options to the Rails::HTML5::SafeListSanitizer instance method `sanitize`:

      ```ruby
      # instance-level option
      Rails::HTML5::SafeListSanitizer.new.sanitize(@article.body, tags: ["noscript"])
      ```

      (note that this class may also be referenced as
      `Rails::Html::SafeListSanitizer`)

    5. setting ActionText::ContentHelper module attribute `allowed_tags`:

      ```ruby
      ActionText::ContentHelper.allowed_tags = ["noscript"]
      ```

    All users overriding the allowed tags by any of the above
    mechanisms to include "noscript" should either upgrade or use
    one of the workarounds.

    ## Workarounds

    Any one of the following actions will work around this issue:

    - Remove "noscript" from the overridden allowed tags,
    - Or, downgrade sanitization to HTML4 (see documentation for
      [`config.action_view.sanitizer_vendor`](https://guides.rubyonrails.org/configuring.html#config-action-view-sanitizer-vendor)
      and [`config.action_text.sanitizer_vendor`](https://guides.rubyonrails.org/configuring.html#config-action-text-sanitizer-vendor)
      for more information).

    ## References

    - [CWE - CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') (4.9)](https://cwe.mitre.org/data/definitions/79.html)
    - Original report: https://hackerone.com/reports/2509647

    ## Credit

    This vulnerability was responsibly reported by HackerOne user
    [@taise](https://hackerone.com/taise?type=user).
  cvss_v4: 2.3
  unaffected_versions:
  - "< 1.6.0"
  patched_versions:
  - ">= 1.6.1"
  related:
    url:
    - https://nvd.nist.gov/vuln/detail/CVE-2024-53989
    - https://github.com/rails/rails-html-sanitizer/security/advisories/GHSA-rxv5-gxqc-xx8g
    - https://github.com/rails/rails-html-sanitizer/commit/16251735e36ebdc302e2f90f2a39cad56879414f
    - https://github.com/advisories/GHSA-rxv5-gxqc-xx8g
---
